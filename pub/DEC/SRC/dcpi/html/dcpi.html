<!-- This file generated automatically by mtex2html(1) -->
<HTML>
<HEAD>
<TITLE>DIGITAL Continuous Profiling Infrastructure</TITLE>
</HEAD>

<BODY BGCOLOR="#ffffff" VLINK="#006633">
<H2>dcpi(1)</H2>

<H3>NAME</H3>
<BLOCKQUOTE>
<P>

dcpi - DIGITAL Continuous Profiling Infrastructure
</BLOCKQUOTE>

<H3>DESCRIPTION</H3>
<BLOCKQUOTE>
<P>

The DIGITAL Continuous Profiling Infrastructure system consists of a
set of tools that provides low-overhead continuous profiling of all
executables, including the kernel.  It is based on periodic sampling
using the Alpha performance counter hardware.  Profiles containing
samples for each executable image (including shared libraries) are
stored in a user-specified directory.<P>

Tools are provided to analyze profiles and produce a breakdown of all
cpu time by image, and by procedure within images.  In addition,
detailed information can be produced showing the time spent executing
each instruction in a procedure and the reasons for static and dynamic
stalls.<P>

For more information, see the 
<A HREF="http://www.research.digital.com/SRC/dcpi/">DIGITAL
Continuous Profiling Infrastructure home page
(http://www.research.digital.com/SRC/dcpi/)</A>.
</BLOCKQUOTE>

<H3>TOOLS</H3>
<BLOCKQUOTE>
<P>

<DL>

<DT>dcpid<DD> 
Continuous profiling daemon.  Extracts raw samples from kernel device
driver, associates them with executable images, and stores them in
profiles on disk.<P>

<DT>dcpiprof<DD>
Analyzes profile data collected by dcpid.  Produces a breakdown of cpu
time by image, or by procedures within images.<P>

<DT>dcpilist<DD>
List the contents of a procedure and annotate the listing with samples
collected during profiling via dcpid.  The listing can contain either
machine instructions, or source lines, or both.  The listing is
annotated with the samples collected during profiling, as well as the
average number of cycles required to execute each instruction or
source line.<P>

<DT>dcpicalc<DD>
Annotates each instruction in a procedure's basic-block graph with
the average number of cycles for that instruction, and computes the
overall average cycle-per-instruction for that procedure.<P>

<DT>dcpiwhatcg<DD>
Produces, for one or more images, a summary breakdown of where time has been
spent (percent of cycles spent in, e.g., memory delays, static stalls,
branch mispredicts, and useful execution).<P>

<DT>dcpitopstalls<DD>
Produces a sorted list of the instructions accounting for the most stall
cycles.<P>

<DT>dcpix<DD> Measure execution counts for basic blocks and
control-flow edges directly; output can be used stall-analysis tools
(dcpicalc, dcpiwhatcg, dcpitopstalls) to produce more accurate
information.  Without dcpix, these tools estimate execution counts.<P>

<DT>dcpisumxct<DD> Aggregates execution counts measured using dcpix
from multiple runs of an instrumented program.  This makes it possible
for stall analysis tools to analyze counts from multiple runs of a
program.<P>

<DT>dcpistats<DD>
Compares multiple sets of raw sample counts and prints various
statistics about them.  Dcpistats is useful for comparing variations
across multiple runs of the same program, or for comparing differences
between slightly different versions of a program.<P>

<DT>dcpidiff<DD>
Compares two sets of profiles for a procedure, highlighting basic
blocks or source lines with the largest differences.<P>

<DT>dcpisource<DD>
Augments a basic-block graph generated by dcpicalc with source code.<P>

<DT>dcpicc<DD>
Compiles C programs to produce object code that helps dcpisource in
identifying which source token each instruction corresponds to.<P>

<DT>dcpi2ps<DD>
Formats a basic-block graph into Postscript.<P>

<DT>dcpi2pix<DD>
Converts DCPI profile data to pixie format.<P>

<DT>dcpikdiff<DD>
Creates a new image based on both vmunix and kmem(7) that captures the
true running kernel image after Digital Unix dynamically patches
itself using self-modifying code.<P>

<DT>dcpictl<DD>
Controls the operation of dcpid.  This subsumes dcpiepoch, dcpiflush,
and dcpiquit (which are still provided for backward compatibility).
Adds functionality to tell the daemon about specific images loaded
into processes when necessary (e.g., when an image is loaded via
mmap).<P>

<DT>dcpiepoch<DD>
Starts a new profiling epoch.  All samples are associated with a time
interval called an <I>epoch</I>.  The analysis tools typically operate
on a set of profiles from a single epoch.<P>

<DT>dcpiflush<DD>
Flushes all unsaved samples from dcpid to profiles on disk.<P>

<DT>dcpiquit<DD>
Terminates the dcpid daemon, flushing all unsaved samples to disk.<P>

<DT>dcpiloader<DD>
A modified version of the standard dynamic loader that provides dcpid
with information about where executables are loaded.<P>

<DT>dcpiscan<DD>
Scans filesystem directories to find executables and associate
executables with filesystem pathnames.<P>

<DT>dcpiversion<DD>
Print the version string and creation date of the installed 
DIGITAL continuous profiling release.<P>

<DT>dcpiuninstall<DD>
Uninstalls DCPI binaries and man pages, and restores the original
version of /sbin/loader.<P>

<DT>dcpicat<DD>
Prints the contents of one or more profile files in an ASCII format.<P>

<DT>dcpiflow<DD>
Generates a basic-block graph for a procedure annotated with samples
collected during profiling via dcpid.  The functionality of this
program has been subsumed by <TT>dcpicalc</TT>.<P>

<DT>dcpidis<DD>
Disassembles a procedure and annotates the disassembly with
samples collected during profiling via dcpid.  This program
is obsolete.  Use <TT>dcpilist</TT> instead.
</DL>
<P>

</BLOCKQUOTE>

<H3><A NAME="example">EXAMPLE USAGE</A></H3>
<BLOCKQUOTE>
<P>

<B>Installation and Setup</B><P>

See the <A HREF="http://www.research.digital.com/SRC/dcpi/">DIGITAL
Continuous Profiling Infrastructure home page (http://www.research.digital.com/SRC/dcpi/)</A> for
details of how to install the device driver, binaries, and man pages
for the profiling system.  Once the system is installed, <TT>dcpiscan</TT>
should be run and one or more profile-database directories should be
created.<P>

<DL>
<DT><TT>dcpiscan <I>directories</I> &gt; map.local</TT><P>

<DD>Create an image map for site-specific executables and shared
libraries in the specified directories and their descendents.
Although this step is technically optional, creating a map
of local executables will allow dcpid to more accurately identify
binaries stored in site-specific directories.  Dcpiscan(1) should
be executed once during system installation, and need only be 
re-executed to scan other directories or newly-installed executables.<P>

<DT><TT>mkdir db</TT><P>

<DD>Make a directory to store profiles.<P>

The profiles written in the
directory are owned by the user who invokes <TT>dcpid</TT>, so the
directory must be writable by that user.  If the directory is shared
across hosts, its permission should be set appropriately to allow
write-sharing by the users running <TT>dcpid</TT>.  The directory must
also be in a partition with a reasonable amount of available space (20
MB or so should be more than adequate). <P>

</DL>
<P>

<B>Data Collection</B><P>

After installation and setup are complete, data is collected
by running <TT>dcpid</TT> and the tools that control it:<P>

<DL>

<DT><TT>dcpid -m map.local db</TT><P>

<DD>Start the dcpid process; <I>(If dcpid is not installed setuid-root as
recommended, then this command must be run as root)</I>.  The optional
argument <TT>map.local</TT> should contain a mapping from executables to
pathnames previously produced by dcpiscan; a default map for
common DIGITAL Unix executables is compiled into dcpid.  <TT>db</TT>
is the database directory created during setup above.<P>

<DT><TT>dcpiepoch</TT><P>

<DD>Terminate the current epoch and start a new one, ensuring that
profiles for the terminated epoch are flushed to disk and won't
change.<P>

<DT><TT>dcpiflush</TT><P>

<DD>Flush buffered samples in the current epoch to the on-disk database.
Note that this is typically not necessary; buffered samples are
flushed to disk whenever an epoch is terminated and when
<TT>dcpid</TT> is terminated.  In addition, buffered samples are
flushed periodically (at intervals that can be controlled with
command-line arguments to <TT>dcpid</TT>).<P>

<DT><TT>dcpiquit</TT><P>

<DD>Terminate the current epoch, flushing all buffered samples to disk,
and exit <TT>dcpid</TT>.  This turns off all performance-counter interrupts
and frees all memory used by the profiling system.<P>

</DL>
<P>

As <TT>dcpid</TT> runs, it creates subdirectories of <TT>db</TT>,
one for each epoch.  Each epoch directory further contains
subdirectories, one for each platform sharing the same <TT>db</TT>.
The platform names default to the local hostname on each machine
running <TT>dcpid</TT>, so by default profiles collected on different
machines are stored separately (though their epochs are synchronized).
However, the file <TT>hosts</TT> in directory <TT>db</TT> may also be edited to
contain a mapping from hostnames
to arbitrary platform names, allowing samples from several hosts to be
aggregated in the same profile database.<P>

<B>Data Analyais</B><P>

After an epoch is terminated, the profile data for the epoch can
be analyzed using a number of tools.  By default, the analysis
tools find the relevant profile files automatically.  There
are also a number of options that can be used to guide the search
for profile files when the default rules are not appropriate;
see the man pages for the individual tools for details.<P>

<DL>

<DT><TT>setenv DCPIDB db</TT><P>

<DD>Set an environment variable that tells the downstream tools where
the profile database is located.<P>

<DT><TT>dcpiprof -i</TT><P>

<DD>Use dcpiprof to analyze the breakdown of cpu time across all
executables that ran during the epoch, broken down by image.<P>

<DT><TT>dcpiprof <I>I</I></TT><P>

<DD>Use dcpiprof to analyze the breakdown of cpu time across all procedures
in the image file <I>I</I>.<P>

<DT><TT>dcpiwhatcg -stall "ITB/I-cache miss" <I>I</I></TT><P>

<DD>Identify the percentage of the CYCLES samples for image file <I>I</I>
that were spent executing instructions vs. waiting for stalls of
various categories; also produce a sorted list of the procedures
in image file <I>I</I> based on the number of cycles spent waiting
for ITB and I-cache misses in each procedure.<P>

<DT><TT>dcpilist -asm <I>P</I> <I>I</I></TT><P>

<DD>Disassemble procedure <I>P</I> in the image file <I>I</I>, and annotate the
disassembly with samples extracted from the profile database and
the average cycle time required for executing each instruction.<P>

<DT><TT>dcpilist -source <I>P</I> <I>I</I></TT><P>

<DD>Generate a source code listing of procedure <I>P</I> in the image file <I>I</I>,
and annotate the listing with samples extracted from the
profile database, and the average cycle time required for executing
each source line.<P>

<DT><TT>dcpicalc <I>P</I> <I>I</I> | dcpisource -f <I>I</I>.c | dcpi2ps -o <I>P</I>.ps</TT><P>

<DD>Produce a basic-block graph for procedure <I>P</I> in image file <I>I</I>;
then augment the graph with source lines from <I>I</I>.c,
calculate the cycle per instruction for each instruction, and store
the resulting Postscript in <I>P</I>.ps.
</DL>
<P>

</BLOCKQUOTE>

<H3>INSTALLATION</H3>
<BLOCKQUOTE>
<P>

Installation instructions are at the
<A HREF="http://www.research.digital.com/SRC/dcpi/">DIGITAL Continuous
Profiling Infrastructure home page (http://www.research.digital.com/SRC/dcpi/)</A>.
</BLOCKQUOTE>

<H3>LIMITATIONS</H3>
<BLOCKQUOTE>
<P>

For processes that use the exec() system call (or its variants), PC samples
are sometimes charged to the wrong image.  Thus, it is possible to get
samples for unexecuted instructions.  Specifically, the problem is that
samples gathered prior to an exec() call may be charged to an image that is
running after exec() returns.  This problem is not serious in practice for
the common case of processes that call exec() once soon after being created:
since there are only a few samples gathered prior to the exec(), only a few
samples can be charged to the wrong image.
</BLOCKQUOTE>

<H3>SEE ALSO</H3>
<BLOCKQUOTE>
<P>

<A HREF="dcpiflow.html">dcpiflow(1)</A>,
<A HREF="dcpiprof.html">dcpiprof(1)</A>,
<A HREF="dcpilist.html">dcpilist(1)</A>,
<A HREF="dcpidis.html">dcpidis(1)</A>,
<A HREF="dcpiscan.html">dcpiscan(1)</A>,
<A HREF="dcpiepoch.html">dcpiepoch(1)</A>,
<A HREF="dcpiflush.html">dcpiflush(1)</A>,
<A HREF="dcpicalc.html">dcpicalc(1)</A>,
<A HREF="dcpilabel.html">dcpilabel(1)</A>,
<A HREF="dcpi2ps.html">dcpi2ps(1)</A>,
<A HREF="dcpicat.html">dcpicat(1)</A>,
<A HREF="dcpiquit.html">dcpiquit(1)</A>,
<A HREF="dcpidiff.html">dcpidiff(1)</A>,
<A HREF="dcpitopstalls.html">dcpitopstalls(1)</A>,
<A HREF="dcpiwhatcg.html">dcpiwhatcg(1)</A>,
<A HREF="dcpictl.html">dcpictl(1)</A>,
<A HREF="dcpisource.html">dcpisource(1)</A>,
<A HREF="dcpicc.html">dcpicc(1)</A>,
<A HREF="dcpiversion.html">dcpiversion(1)</A>,
<A HREF="dcpiuninstall.html">dcpiuninstall(1)</A>,
<A HREF="dcpi2pix.html">dcpi2pix(1)</A>,
<A HREF="dcpikdiff.html">dcpikdiff(1)</A>,
<A HREF="dcpix.html">dcpix(1)</A>,
<A HREF="dcpisumxct.html">dcpisumxct(1)</A>,
<A HREF="dcpistats.html">dcpistats(1)</A>,
<A HREF="dcpid.html">dcpid(1)</A>,
<A HREF="dcpiformat.html">dcpiformat(4)</A>,
<A HREF="dcpiloader.html">dcpiloader(5)</A><P>

For more information, see the 
<A HREF="../home.html">DIGITAL Continuous
Profiling Infrastructure project home page
(http://www.research.digital.com/SRC/dcpi/ from outside DIGITAL)</A>.
</BLOCKQUOTE>

<H3>COPYRIGHT</H3>
<BLOCKQUOTE>
<P>

<a href="http://www.digital.com/info/tm.html">
Copyright 1996-97, Digital Equipment Corporation.
</a>
</BLOCKQUOTE>

<H3>AUTHORS</H3>
<BLOCKQUOTE>
<P>

Jennifer Anderson,
Lance Berc,
Jeff Dean,
Sanjay Ghemawat,
Monika Henzinger,
Shun-Tak Leung,
Mitch Lichtenberg,
Dick Sites,
Mark Vandevoorde,
Carl Waldspurger,
Bill Weihl.
</BLOCKQUOTE>

This page was generated automatically by
<A HREF="http://www.research.digital.com/SRC/mtex/">mtex software</A>.
</BODY>
</HTML>
