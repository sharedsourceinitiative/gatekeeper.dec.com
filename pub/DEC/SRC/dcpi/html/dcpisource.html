<!-- This file generated automatically by mtex2html(1) -->
<HTML>
<HEAD>
<TITLE>dcpisource</TITLE>
</HEAD>

<BODY BGCOLOR="#ffffff" VLINK="#006633">
<H2>dcpisource(1)</H2>

<H3>NAME</H3>
<BLOCKQUOTE>
<P>

dcpisource - Augment a DIGITAL Continuous Profiling Infrastructure basic-block graph with source code
</BLOCKQUOTE>

<H3>SYNOPSIS</H3>
<BLOCKQUOTE>
<P>

<B>dcpisource</B> [-src <I>source-file</I>] [-map <I>map-file</I>] [<I>graph-file</I>]
</BLOCKQUOTE>

<H3>FLAGS</H3>
<BLOCKQUOTE>
<P>

<DL>

<DT>-src source-file<DD> The source code that is added to the graph is
extracted from the specified source file.  The option <I>-f</I> is also
accepted for backward compatibility.<P>

<DT>-map map-file<DD> A map file, produced by <A HREF="dcpicc.html">dcpicc</A>,
mapping line numbers in the object code to the true line and column numbers
for source tokens in the original source file.<P>

</DL>
<P>

</BLOCKQUOTE>

<H3>DESCRIPTION</H3>
<BLOCKQUOTE>
<P>

Dcpisource reads a Continuous Profiling Infrastructure basic-block graph
either from a file specified on the command line, or from standard input if
no files are specified on the command line.  The graph can be generated
either by dcpiflow(1) or dcpicalc(1).  If dcpisource can find the source
code that corresponds to the basic block graph, it prints out a graph
augmented with the source code, otherwise it prints out the input graph
unchanged.  If dcpisource cannot find the appropriate source file
automatically, the user can supply it with the <TT>-src</TT> flag.  The output
of dcpisource can be converted to postscript by dcpi2ps(1).<P>

If the object code was compiled using dcpicc, you may also specify the map
file generated by <A HREF="dcpicc.html">dcpicc</A>.  This allows dcpisource to
append to each instruction information on the corresponding source-level
expression.  (To reduce cluttering, if a sequence of instructions in the
same basic block correspond to the same source-level expression, the
expression is printed only with the first instruction.)  The precision of
this information depends on how the C compiler (which dcpicc invokes)
assign source line numbers to instructions it generates.
</BLOCKQUOTE>

<H3>LIMITATIONS</H3>
<BLOCKQUOTE>
<P>

How precisely dcpisource identifies the source-level tokens corresponding
to individual instructions depends very much on how the C compiler assigns
source line numbers to the instructions it generates.  Generally, with C
compilers for Digital Unix 4.0 or above, dpisource indicates for each
instruction the first source token (in textual order) of the source-level
expression for which that instruction is generated.  For example, in the
following (abbreviated) output
<PRE>
B0.4 020654 B
  309: } else if ((start_pc + (next_inst &lt;&lt; 2))        0
 020654  ldl     v0, 140(sp)       309: next_inst &lt;&lt; 2)) &amp; 0x7) {
 020658  s4addq  v0, zero, v0      
 02065c  ldq     a0, 120(sp)       309: start_pc + (next_inst &lt;&lt; 2)) &amp; 0x7) {
 020660  addq    a0, v0, v0        
 020664  and     v0, 0x7, v0       309: (start_pc + (next_inst &lt;&lt; 2)) &amp; 0x7) {
 020668  beq     v0, 0x120020678   309: if ((start_pc + (next_inst &lt;&lt; 2)) &amp; 0x7)
</PRE>

the first two instructions compute the expression <TT>next_inst &lt;&lt; 2</TT>, the
third and fourth compute <TT>start_pc + (next_inst &lt;&lt; 2)</TT>, the fifth
computes <TT>(start_pc + (next_inst &lt;&lt; 2)) &amp; 0x7</TT>, and the final branch
instruction implements the <TT>if</TT> conditional statement itself.  The
output does not distinguish between an expression and its (textually) first
sub-expression.  For example, in <TT>p1-&gt;p2-&gt;p3-&gt;p4</TT>, the instructions for
<TT>p1-&gt;p2</TT> and the subsequent instructions evaluating <TT>p1-&gt;p2-&gt;p3</TT> and
the full <TT>p1-&gt;p2-&gt;p3-&gt;p4</TT> would all be attributed to the first source
token, namely <TT>p1</TT>.  The following specific limitations are also known.<P>

<UL>

<LI> In a function call, the "top-level" instructions that evaluate the
arguments are attributed to the function call itself, rather than the
arguments.  (Instructions evaluating the sub-expressions, however, are
correctly attributed.)  For example, in <TT>foo(1 + a[i+1], x, y)</TT>, the
instructions computing <TT>a[i+1]</TT> and all its sub-expressions are
attributed to the appropriate source tokens.  However, the <TT>addl</TT>
instruction that finally evaluates the function argument is attributed to
the function call (and hence to the token for the function, namely
<TT>foo</TT>).<P>

<LI>
In a preprocessor macro with arguments (which textually looks like a
function call), the instructions evaluating the macro, its arguments, or
their sub-expressions are all attributed to the name of the macro.<P>

<LI>
When a scalar variable or argument local to a function is moved
between a register and the stack, the load and store instructions are
attributed to the immediately enclosing expression that involves the
variable, rather than the variable itself.  For example, if the value of
local variable <TT>b</TT> has to be loaded from the stack to evaluate <TT>a+b</TT>,
the load instruction is attributed to the expression <TT>a+b</TT> (and hence to
its textually first token, <TT>a</TT>, rather than <TT>b</TT>).<P>

</UL>
<P>

With some earlier versions of the compiler, instructions are attributed to
a statement, rather than an expression.  Specifically, all instructions
calculating the right-hand side of an assignment, as well as the assignment
itself, are attributed to the assignment operator.
</BLOCKQUOTE>

<H3>TYPICAL USAGE</H3>
<BLOCKQUOTE>
<P>

Typically, <TT>dcpisource</TT>, <TT>dcpicalc</TT>, and <TT>dcpi2ps</TT> are used together as follows:
<PRE>
dcpicalc -db db idle_thread /vmunix | \
dcpisource -src /src/kernel/kern/sched_prim.c | \
dcpi2ps -o idle_thread.ps 
</PRE>

</BLOCKQUOTE>

<H3>SEE ALSO</H3>
<BLOCKQUOTE>
<P>

<A HREF="dcpi.html">dcpi(1)</A>,
<A HREF="dcpiflow.html">dcpiflow(1)</A>,
<A HREF="dcpiprof.html">dcpiprof(1)</A>,
<A HREF="dcpilist.html">dcpilist(1)</A>,
<A HREF="dcpidis.html">dcpidis(1)</A>,
<A HREF="dcpiscan.html">dcpiscan(1)</A>,
<A HREF="dcpiepoch.html">dcpiepoch(1)</A>,
<A HREF="dcpiflush.html">dcpiflush(1)</A>,
<A HREF="dcpicalc.html">dcpicalc(1)</A>,
<A HREF="dcpilabel.html">dcpilabel(1)</A>,
<A HREF="dcpi2ps.html">dcpi2ps(1)</A>,
<A HREF="dcpicat.html">dcpicat(1)</A>,
<A HREF="dcpiquit.html">dcpiquit(1)</A>,
<A HREF="dcpidiff.html">dcpidiff(1)</A>,
<A HREF="dcpitopstalls.html">dcpitopstalls(1)</A>,
<A HREF="dcpiwhatcg.html">dcpiwhatcg(1)</A>,
<A HREF="dcpictl.html">dcpictl(1)</A>,
<A HREF="dcpicc.html">dcpicc(1)</A>,
<A HREF="dcpiversion.html">dcpiversion(1)</A>,
<A HREF="dcpiuninstall.html">dcpiuninstall(1)</A>,
<A HREF="dcpi2pix.html">dcpi2pix(1)</A>,
<A HREF="dcpikdiff.html">dcpikdiff(1)</A>,
<A HREF="dcpix.html">dcpix(1)</A>,
<A HREF="dcpisumxct.html">dcpisumxct(1)</A>,
<A HREF="dcpistats.html">dcpistats(1)</A>,
<A HREF="dcpid.html">dcpid(1)</A>,
<A HREF="dcpiformat.html">dcpiformat(4)</A>,
<A HREF="dcpiloader.html">dcpiloader(5)</A><P>

For more information, see the 
<A HREF="../home.html">DIGITAL Continuous
Profiling Infrastructure project home page
(http://www.research.digital.com/SRC/dcpi/ from outside DIGITAL)</A>.
</BLOCKQUOTE>

<H3>COPYRIGHT</H3>
<BLOCKQUOTE>
<P>

<a href="http://www.digital.com/info/tm.html">
Copyright 1996-97, Digital Equipment Corporation.
</a>
</BLOCKQUOTE>

<H3>AUTHOR</H3>
<BLOCKQUOTE>
Sanjay Ghemawat,
Monika Henzinger,
Shun-Tak Leung
</BLOCKQUOTE>

This page was generated automatically by
<A HREF="http://www.research.digital.com/SRC/mtex/">mtex software</A>.
</BODY>
</HTML>
